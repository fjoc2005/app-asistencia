<!-- ===================================
     INTEGRACIÓN MANUAL - ADMIN.HTML
     Copiar estos bloques en las secciones indicadas
     =================================== -->

<!-- 1. AGREGAR ANTES DEL CIERRE DE </body> (línea ~901) -->
<!-- Reemplazar el bloque de scripts existente con este: -->

<script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

<!-- Lazy Loader Utility -->
<script src="js/utils/lazy-loader.js"></script>

<!-- Error Handler -->
<script src="js/services/error-handler.js"></script>

<!-- ✨ NUEVOS SERVICIOS ✨ -->
<script src="js/services/meeting-attendance.js"></script>
<script src="js/services/discount-manager.js"></script>

<!-- Admin Core -->
<script>
    const ts = new Date().getTime();
    document.write('<script src="admin.js?v=' + ts + '"><\/script>');
</script>

<!-- Lazy Loading de módulos pesados -->
<script>
    if (typeof lazyLoader !== 'undefined') {
        lazyLoader.preload([
            { src: 'google-drive-integration.js', id: 'drive-integration' },
            { src: 'ai-assistant.js', id: 'ai-assistant' }
        ]);
    }
</script>

<script>
    lucide.createIcons();
</script>

<!-- ===================================
     2. MODAL NUEVO DESCUENTO
     Agregar antes del cierre de </body>
     =================================== -->

<div id="modalNuevoDescuento" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Nuevo Descuento - <span id="descuentoSociaNombre"></span></h3>
            <button class="btn-icon" onclick="document.getElementById('modalNuevoDescuento').style.display='none'">
                <i data-lucide="x"></i>
            </button>
        </div>

        <input type="hidden" id="descuentoSociaRut">

        <form onsubmit="event.preventDefault(); guardarNuevoDescuento();">
            <div class="form-group">
                <label>Comercio/Entidad:</label>
                <input type="text" id="descuentoComercio" required class="form-control">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Monto Total:</label>
                    <input type="number" id="descuentoMonto" required class="form-control" min="0">
                </div>

                <div class="form-group">
                    <label>Número de Cuotas:</label>
                    <input type="number" id="descuentoCuotas" required class="form-control" min="1">
                </div>
            </div>

            <div class="form-group">
                <label>Fecha Inicio:</label>
                <input type="date" id="descuentoFecha" required class="form-control">
            </div>

            <div class="form-group">
                <label>Observaciones:</label>
                <textarea id="descuentoObservaciones" class="form-control" rows="3"></textarea>
            </div>

            <div class="modal-actions">
                <button type="submit" class="btn-primary">
                    <i data-lucide="save"></i> Guardar Descuento
                </button>
                <button type="button" class="btn-secondary"
                    onclick="document.getElementById('modalNuevoDescuento').style.display='none'">
                    Cancelar
                </button>
            </div>
        </form>
    </div>
</div>

<!-- ===================================
     3. MODAL ESTADO SOCIA
     Agregar después del modal anterior
     =================================== -->

<div id="modalEstadoSocia" class="modal" style="display: none;">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h3>Historial de Descuentos - <span id="estadoSociaNombre"></span></h3>
            <button class="btn-icon" onclick="document.getElementById('modalEstadoSocia').style.display='none'">
                <i data-lucide="x"></i>
            </button>
        </div>

        <div class="resumen-deuda">
            <div class="stat-card">
                <h4 id="estadoDeudaTotal">$0</h4>
                <p>Deuda Total Vigente</p>
            </div>
            <div class="stat-card">
                <h4 id="estadoDescuentosVigentes">0</h4>
                <p>Descuentos Activos</p>
            </div>
            <div class="stat-card">
                <h4 id="estadoDescuentosFinalizados">0</h4>
                <p>Descuentos Finalizados</p>
            </div>
        </div>

        <h4>Historial Completo</h4>
        <div id="historialDescuentosContainer"></div>
    </div>
</div>

<!-- ===================================
     4. MODAL JUSTIFICAR ASISTENCIA
     Para la matriz de asistencia
     =================================== -->

<div id="modalJustificar" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Justificar Ausencia</h3>
            <button class="btn-icon" onclick="document.getElementById('modalJustificar').style.display='none'">
                <i data-lucide="x"></i>
            </button>
        </div>

        <input type="hidden" id="justificarMeetingId">
        <input type="hidden" id="justificarSociaRut">

        <p><strong>Socia:</strong> <span id="justificarSociaNombre"></span></p>

        <div class="form-group">
            <label>Motivo de la justificación:</label>
            <textarea id="justificarMotivo" class="form-control" rows="4" required></textarea>
        </div>

        <div class="modal-actions">
            <button class="btn-primary" onclick="guardarJustificacion()">
                <i data-lucide="check"></i> Guardar Justificación
            </button>
            <button class="btn-secondary" onclick="document.getElementById('modalJustificar').style.display='none'">
                Cancelar
            </button>
        </div>
    </div>
</div>

<!-- ===================================
     5. ESTILOS ADICIONALES
     Agregar en <head> o en styles.css
     =================================== -->

<style>
    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
    }

    .modal-large {
        max-width: 900px;
    }

    .resumen-deuda {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin: 2rem 0;
    }

    .badge-success {
        background: #10b981;
        color: white;
        padding: 4px 12px;
        border-radius: 12px;
    }

    .badge-warning {
        background: #f59e0b;
        color: white;
        padding: 4px 12px;
        border-radius: 12px;
    }

    .badge-danger {
        background: #ef4444;
        color: white;
        padding: 4px 12px;
        border-radius: 12px;
    }

    .badge-secondary {
        background: #6b7280;
        color: white;
        padding: 4px 12px;
        border-radius: 12px;
    }

    .acciones-socia {
        display: flex;
        gap: 1rem;
        margin: 1rem 0;
        flex-wrap: wrap;
    }

    .tabla-descuentos {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1rem;
    }

    .tabla-descuentos th,
    .tabla-descuentos td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #e5e7eb;
    }

    .tabla-descuentos th {
        background: #f9fafb;
        font-weight: 600;
    }

    .btn-xs {
        padding: 4px 8px;
        font-size: 0.875rem;
    }

    .matriz-header {
        background: var(--glass-bg);
        padding: 1.5rem;
        border-radius: var(--radius-md);
        margin-bottom: 1.5rem;
    }

    .matriz-actions {
        margin-top: 2rem;
        display: flex;
        justify-content: flex-end;
    }

    .tabla-matriz {
        width: 100%;
        border-collapse: collapse;
    }

    .tabla-matriz th,
    .tabla-matriz td {
        padding: 12px;
        text-align: left;
        border: 1px solid #e5e7eb;
    }

    .tabla-matriz th {
        background: #f9fafb;
        font-weight: 600;
        position: sticky;
        top: 0;
        z-index: 10;
    }
</style>